# crossover-trial

'Crossover-Trial-Simulation'
Introduce a function to simulate ABBA crossover study 
https://github.com/eamonn2014/crossover-trial/blob/master/Crossover-Trial-Simulation.pdf

'Crossover-Trial-Simulation-Power'
Showing the analysis of ABBA using lme4 and nlme
https://github.com/eamonn2014/crossover-trial/blob/master/Crossover-Trial-Simulation-Power.pdf


'Crossover-Trial-Further-Simulation-and-Plotting' 
Simulate more sophisticatedly where one can vary one parameter. Simulate one trial and go on to analyse, the focus though is on plotting the data.
https://github.com/eamonn2014/crossover-trial/blob/master/Crossover-Trial-Further-Simulation-and-Plotting.pdf


'THE-TWO-PERIOD-CROSS-OVER-CLINICAL-TRIAL' Based on Stephen Senn talk on youtube https://www.youtube.com/watch?v=uTrVhIwy8e8 '70 Years Old and Still Here: The Randomized Clinical Trial and its Critics - Stephen Senn' Here I analyse the trial and plot the data whilst duplicating Senn's presentaion (permutation approach to the analysis). An improved plot for ABBA here also.
https://github.com/eamonn2014/crossover-trial/blob/master/THE-TWO-PERIOD-CROSS-OVER-CLINICAL-TRIAL.pdf


ABBA Shiny App.
This simulates a two period crossver trial, plots and performs analysis. The code is in the App in the repository and is deployed here:
https://eamonn.shinyapps.io/ABBA/

  
Crossover-Trial-Power-Simulation-en-mass-and-Plotting.Rmd and pdf
This explores power for ABBA crossover trial allowing more than one parameter to vary and plot the results
https://github.com/eamonn2014/crossover-trial/blob/master/Crossover-Trial-Power-Simulation-en-mass-and-Plotting.pdf

structure(list(usubjid = structure(c("3000_00001", "3000_00001", 
"3000_00001", "3000_00001", "3000_00001", "3000_00001", "3000_00001", 
"3000_00001", "3000_00002", "3000_00002", "3000_00002", "3000_00002", 
"3000_00002", "3000_00002", "3000_00002", "3000_00002", "3000_00003", 
"3000_00003", "3000_00003", "3000_00003", "3000_00003", "3000_00003", 
"3000_00003", "3000_00003", "3000_00004", "3000_00004", "3000_00004", 
"3000_00004", "3000_00004", "3000_00004", "3000_00004", "3000_00004", 
"3000_00006", "3000_00006", "3000_00006", "3000_00006", "3000_00006", 
"3000_00006", "3001_00001", "3001_00001", "3001_00001", "3001_00001", 
"3001_00001", "3001_00001", "3001_00001", "3001_00001", "3001_00001", 
"3001_00001", "3001_00003", "3001_00003", "3001_00003", "3001_00003", 
"3001_00003", "3001_00003", "3001_00003", "3001_00003", "3001_00003", 
"3001_00003", "3001_00004", "3001_00004", "3001_00004", "3001_00004", 
"3001_00004", "3001_00004", "3002_00001", "3002_00001", "3002_00001", 
"3002_00001", "3002_00001", "3002_00001", "3002_00001", "3002_00001", 
"3002_00002", "3002_00002", "3002_00002", "3002_00002", "3002_00002", 
"3002_00002", "3002_00002", "3002_00002", "3004_00001", "3004_00001", 
"3004_00001", "3004_00001", "3004_00001", "3004_00001", "3004_00001", 
"3004_00001", "3004_00001", "3004_00001", "3004_00001", "3004_00001", 
"3004_00002", "3004_00002", "3004_00002", "3004_00002", "3004_00002", 
"3004_00002", "3004_00002", "3004_00002", "3004_00002", "3004_00002", 
"3004_00002", "3004_00002", "3004_00003", "3004_00003", "3004_00003", 
"3004_00003", "3004_00003", "3004_00003", "3004_00003", "3004_00003", 
"3004_00003", "3004_00003", "3004_00004", "3004_00004", "3004_00004", 
"3004_00004", "3004_00004", "3004_00004", "3004_00004", "3004_00004", 
"3005_00002", "3005_00002", "3005_00002", "3005_00002", "3005_00002", 
"3005_00002", "3005_00002", "3005_00002", "3006_00001", "3006_00001", 
"3006_00001", "3006_00001", "3006_00001", "3006_00001", "3006_00001", 
"3006_00001", "3100_00001", "3100_00001", "3100_00001", "3100_00001", 
"3100_00001", "3100_00001", "3100_00001", "3100_00001", "3100_00001", 
"3100_00001", "3100_00001", "3100_00001", "3100_00001", "3100_00001", 
"3100_00001", "3100_00001", "3100_00002", "3100_00002", "3100_00002", 
"3100_00002", "3100_00002", "3100_00002", "3100_00002", "3100_00002", 
"3100_00002", "3100_00002", "3100_00002", "3100_00002", "3100_00002", 
"3100_00002", "3100_00002", "3100_00002", "3100_00002", "3100_00002", 
"3100_00007", "3100_00007", "3100_00007", "3100_00007", "3100_00007", 
"3100_00007", "3100_00007", "3100_00007", "3100_00007", "3100_00007", 
"3304_00002", "3304_00002", "3304_00002", "3304_00002", "3304_00002", 
"3304_00002", "3304_00002", "3304_00002", "3305_00007", "3305_00007", 
"3305_00007", "3305_00007", "3305_00007", "3305_00007", "3305_00007", 
"3305_00007", "3305_00007", "3305_00007", "3305_00009", "3305_00009", 
"3305_00009", "3305_00009", "3305_00009", "3305_00009", "3305_00009", 
"3305_00009", "3305_00011", "3305_00011", "3305_00011", "3305_00011", 
"3305_00011", "3305_00011", "3305_00011", "3305_00011", "3305_00011", 
"3305_00011", "3305_00012", "3305_00012", "3305_00012", "3305_00012", 
"3305_00012", "3305_00012", "3305_00015", "3305_00015", "3305_00015", 
"3305_00015", "3305_00015", "3305_00015", "3305_00015", "3305_00015", 
"3305_00016", "3305_00016", "3305_00016", "3305_00016", "3305_00016", 
"3305_00016", "3305_00017", "3305_00017", "3305_00017", "3305_00017", 
"3305_00017", "3305_00017", "3305_00018", "3305_00018", "3305_00018", 
"3305_00018", "3305_00018", "3305_00018", "3305_00018", "3305_00018", 
"3305_00019", "3305_00019", "3305_00019", "3305_00019", "3305_00019", 
"3305_00019", "3306_00001", "3306_00001", "3306_00001", "3306_00001", 
"3306_00001", "3306_00001", "3306_00001", "3306_00001", "3306_00001", 
"3306_00001", "3307_00001", "3307_00001", "3307_00001", "3307_00001", 
"3307_00001", "3307_00001", "3307_00001", "3307_00001", "3307_00001", 
"3307_00001", "3307_00006", "3307_00006", "3307_00006", "3307_00006", 
"3307_00006", "3307_00006", "3307_00006", "3307_00006", "3307_00007", 
"3307_00007", "3307_00007", "3307_00007", "3307_00007", "3307_00007", 
"3308_00001", "3308_00001", "3308_00001", "3308_00001", "3308_00001", 
"3308_00001", "3308_00001", "3308_00001", "3308_00001", "3310_00001", 
"3310_00001", "3310_00001", "3310_00001", "3310_00001", "3310_00001", 
"3310_00001", "3310_00001", "3310_00001", "3310_00001", "3310_00002", 
"3310_00002", "3310_00002", "3310_00002", "3310_00002", "3310_00002", 
"3310_00003", "3310_00003", "3310_00003", "3310_00003", "3310_00003", 
"3310_00003", "3310_00003", "3310_00003", "3311_00001", "3311_00001", 
"3311_00001", "3311_00001", "3311_00001", "3311_00001", "3311_00001", 
"3311_00001", "3311_00002", "3311_00002", "3311_00002", "3311_00002", 
"3311_00002", "3311_00002", "3311_00002", "3311_00002", "3313_00002", 
"3313_00002", "3313_00002", "3313_00002", "3313_00002", "3313_00002", 
"3313_00002", "3313_00002", "3313_00002", "3313_00002", "3313_00003", 
"3313_00003", "3313_00003", "3313_00003", "3313_00003", "3313_00003", 
"3400_00002", "3400_00002", "3400_00002", "3400_00002", "3400_00002", 
"3400_00002", "3400_00002", "3400_00002", "3403_00001", "3403_00001", 
"3403_00001", "3403_00001", "3403_00001", "3403_00001", "3403_00001", 
"3403_00001", "3403_00001", "3407_00002", "3407_00002", "3407_00002", 
"3407_00002", "3407_00002", "3407_00002", "3407_00002", "3407_00002", 
"3409_00001", "3409_00001", "3409_00001", "3409_00001", "3409_00001", 
"3409_00001", "3409_00001", "3409_00001", "3409_00001", "3409_00001", 
"3409_00002", "3409_00002", "3409_00002", "3409_00002", "3409_00002", 
"3409_00002", "3409_00002", "3409_00002", "3409_00002", "3409_00002", 
"3412_00001", "3412_00001", "3412_00001", "3412_00001", "3412_00001", 
"3412_00001", "3413_00001", "3413_00001", "3413_00001", "3413_00001", 
"3413_00001", "3413_00001", "3413_00001", "3413_00001", "3413_00001", 
"3413_00001", "3413_00001", "3413_00001", "3427_00001", "3427_00001", 
"3427_00001", "3427_00001", "3427_00001", "3427_00001", "3430_00002", 
"3430_00002", "3430_00002", "3430_00002", "3430_00002", "3430_00002", 
"3434_00001", "3434_00001", "3434_00001", "3434_00001", "3434_00001", 
"3434_00001", "3434_00001", "3434_00001", "3434_00001", "3434_00001", 
"3434_00002", "3434_00002", "3434_00002", "3434_00002", "3434_00002", 
"3434_00002", "3434_00002", "3860_00004", "3860_00004", "3860_00004", 
"3860_00004", "3860_00004", "3860_00004", "3860_00004", "3860_00004", 
"3860_00004", "3860_00004", "3860_00004", "3860_00004", "3860_00004", 
"3900_00001", "3900_00001", "3900_00001", "3900_00001", "3900_00001", 
"3900_00001", "3900_00002", "3900_00002", "3900_00002", "3900_00002", 
"3900_00002", "3900_00002", "3900_00002", "3900_00002", "3900_00002", 
"3900_00002", "3900_00002", "3900_00002", "3900_00003", "3900_00003", 
"3900_00003", "3900_00003", "3900_00003", "3900_00003", "3900_00003", 
"3900_00003", "3900_00003", "3900_00003", "3901_00001", "3901_00001", 
"3901_00001", "3901_00001", "3901_00001", "3901_00001", "3901_00001", 
"3901_00001", "3901_00001", "3901_00001", "3902_00003", "3902_00003", 
"3902_00003", "3902_00003", "3902_00003", "3902_00003", "3902_00003", 
"3902_00003", "3902_00003", "3902_00003", "3902_00004", "3902_00004", 
"3902_00004", "3902_00004", "3902_00004", "3902_00004", "3902_00004", 
"3902_00004", "3902_00005", "3902_00005", "3902_00005", "3902_00005", 
"3902_00005", "3902_00005", "3903_00001", "3903_00001", "3903_00001", 
"3903_00001", "3903_00001", "3903_00001", "3903_00001", "3903_00001", 
"3903_00001", "3903_00001", "3903_00001", "3903_00001", "3903_00001", 
"3903_00001", "3903_00001", "3903_00001", "3903_00002", "3903_00002", 
"3903_00002", "3903_00002", "3903_00002", "3903_00002", "3903_00002", 
"3903_00002", "3903_00002", "3903_00002", "3903_00004", "3903_00004", 
"3903_00004", "3903_00004", "3903_00004", "3903_00004", "3905_00001", 
"3905_00001", "3905_00001", "3905_00001", "3905_00001", "3905_00001", 
"3905_00001", "3905_00001", "3905_00001", "3905_00001", "3905_00002", 
"3905_00002", "3905_00002", "3905_00002", "3905_00002", "3905_00002", 
"3906_00007", "3906_00007", "3906_00007", "3906_00007", "3906_00007", 
"3906_00007", "3906_00007", "3906_00007", "3906_00007", "3906_00007", 
"3906_00008", "3906_00008", "3906_00008", "3906_00008", "3906_00008", 
"3906_00008", "3907_00002", "3907_00002", "3907_00002", "3907_00002", 
"3907_00002", "3907_00002", "3908_00010", "3908_00010", "3908_00010", 
"3908_00010", "3908_00010", "3908_00010", "3908_00010", "3908_00010", 
"3908_00011", "3908_00011", "3908_00011", "3908_00011", "3908_00011", 
"3908_00011", "3908_00011", "3908_00011", "3908_00013", "3908_00013", 
"3908_00013", "3908_00013", "3908_00013", "3908_00013", "3908_00013", 
"3908_00013", "3908_00015", "3908_00015", "3908_00015", "3908_00015", 
"3908_00015", "3908_00015", "3908_00017", "3908_00017", "3908_00017", 
"3908_00017", "3908_00017", "3908_00017", "3908_00017", "3908_00017", 
"3909_00002", "3909_00002", "3909_00002", "3909_00002", "3909_00002", 
"3909_00002", "3909_00002", "3909_00002", "3909_00002", "3909_00002", 
"3910_00001", "3910_00001", "3910_00001", "3910_00001", "3910_00001", 
"3910_00001", "3910_00001", "3910_00001", "3910_00001", "3910_00004", 
"3910_00004", "3910_00004", "3910_00004", "3910_00004", "3910_00004", 
"3910_00004", "3910_00004", "3910_00004", "3910_00005", "3910_00005", 
"3910_00005", "3910_00005", "3910_00005", "3910_00005", "3910_00005", 
"3910_00005", "3910_00007", "3910_00007", "3910_00007", "3910_00007", 
"3910_00007", "3910_00007", "3910_00008", "3910_00008", "3910_00008", 
"3910_00008", "3910_00008", "3910_00008", "3910_00008", "3910_00008", 
"3910_00008", "3911_00001", "3911_00001", "3911_00001", "3911_00001", 
"3911_00001", "3911_00001", "3911_00001", "3911_00001", "3911_00001", 
"3911_00001", "3911_00001", "3911_00001", "3911_00002", "3911_00002", 
"3911_00002", "3911_00002", "3911_00002", "3911_00002", "3911_00002", 
"3911_00002", "3911_00002", "3911_00002", "3911_00002", "3911_00002", 
"3911_00002", "3911_00002", "3911_00002", "3911_00002", "3911_00003", 
"3911_00003", "3911_00003", "3911_00003", "3911_00003", "3911_00003", 
"3911_00003", "3911_00003", "4300_00002", "4300_00002", "4300_00002", 
"4300_00002", "4300_00002", "4300_00002", "4301_00001", "4301_00001", 
"4301_00001", "4301_00001", "4301_00001", "4301_00001", "4301_00001", 
"4301_00001", "4301_00001", "4301_00001", "4301_00002", "4301_00002", 
"4301_00002", "4301_00002", "4301_00002", "4301_00002", "4301_00002", 
"4301_00002", "4301_00002", "4301_00002", "4303_00002", "4303_00002", 
"4303_00002", "4303_00002", "4303_00002", "4303_00002", "4303_00002", 
"4303_00002", "4303_00002", "4303_00002", "4303_00002", "4303_00002", 
"4303_00003", "4303_00003", "4303_00003", "4303_00003", "4303_00003", 
"4303_00003", "4303_00003", "4303_00003", "4303_00003", "4303_00003", 
"4501_00001", "4501_00001", "4501_00001", "4501_00001", "4501_00001", 
"4501_00001", "4501_00001", "4501_00001", "4501_00001", "4501_00001", 
"4501_00001", "4502_00001", "4502_00001", "4502_00001", "4502_00001", 
"4502_00001", "4502_00001", "4502_00001", "4502_00001", "4502_00001", 
"4502_00001", "4502_00001", "4502_00001", "4502_00001", "4600_00001", 
"4600_00001", "4600_00001", "4600_00001", "4600_00001", "4600_00001", 
"4600_00001", "4600_00001", "4600_00001", "4600_00001", "4600_00001", 
"4600_00001", "4600_00001", "4600_00001", "4600_00001", "4600_00001", 
"4600_00001", "4600_00001", "4600_00001", "4600_00001", "4600_00002", 
"4600_00002", "4600_00002", "4600_00002", "4600_00002", "4600_00002", 
"4600_00002", "4600_00002", "4600_00002", "4600_00002", "4600_00002", 
"4600_00002", "4600_00002", "4601_00001", "4601_00001", "4601_00001", 
"4601_00001", "4601_00001", "4601_00001", "4601_00001", "4601_00001", 
"4601_00001", "4601_00001", "4700_00001", "4700_00001", "4700_00001", 
"4700_00001", "4700_00001", "4700_00001", "4700_00001", "4700_00001", 
"4700_00001", "4700_00001", "4700_00001", "4700_00001", "4700_00002", 
"4700_00002", "4700_00002", "4700_00002", "4700_00002", "4700_00002", 
"4700_00002", "4700_00002", "4700_00002", "4700_00002", "4700_00003", 
"4700_00003", "4700_00003", "4700_00003", "4700_00003", "4700_00003", 
"4700_00003", "4700_00003", "4700_00003", "4700_00003", "4701_00001", 
"4701_00001", "4701_00001", "4701_00001", "4701_00002", "4701_00002", 
"4701_00002", "4701_00002", "4701_00002", "4701_00002", "4701_00002", 
"4701_00002", "4701_00003", "4701_00003", "4701_00003", "4701_00003", 
"4701_00003", "4701_00003", "4901_00002", "4901_00002", "4901_00002", 
"4901_00002", "4901_00002", "4901_00002", "4901_00002", "4901_00002", 
"4903_00001", "4903_00001", "4903_00001", "4903_00001", "4903_00001", 
"4903_00001", "4903_00001", "4903_00001", "4903_00001", "4903_00001", 
"4903_00001", "4903_00001", "4903_00001", "4903_00001", "4903_00001", 
"4903_00001", "4906_00001", "4906_00001", "4906_00001", "4906_00001", 
"4906_00001", "4906_00001", "4906_00001", "4906_00001", "4906_00001", 
"4906_00001", "4906_00001", "4906_00001", "4906_00001", "4907_00001", 
"4907_00001", "4907_00001", "4907_00001", "4907_00001", "4907_00001", 
"4907_00001", "4907_00001", "4907_00001", "4907_00001", "4907_00001", 
"4907_00001", "4907_00001", "4907_00001", "4907_00001", "4907_00001", 
"4907_00002", "4907_00002", "4907_00002", "4907_00002", "4907_00002", 
"4907_00002", "4907_00002", "4907_00002", "4907_00002", "4907_00002", 
"4907_00002", "4907_00002", "4908_00001", "4908_00001", "4908_00001", 
"4908_00001", "4908_00001", "4908_00001", "4908_00001", "4908_00001", 
"4908_00003", "4908_00003", "4908_00003", "4908_00003", "4909_00003", 
"4909_00003", "4909_00003", "4909_00003", "4909_00003", "4909_00003", 
"4909_00003", "4909_00003", "4909_00004", "4909_00004", "4909_00004", 
"4909_00004", "4909_00004", "4909_00004", "4909_00005", "4909_00005", 
"4909_00005", "4909_00005", "4909_00005", "4909_00005", "4910_00001", 
"4910_00001", "4910_00001", "4910_00001", "4910_00001", "4910_00001", 
"4910_00001", "4910_00001", "4910_00002", "4910_00002", "4910_00002", 
"4910_00002", "4910_00002", "4910_00002", "4910_00002", "4910_00002", 
"4911_00001", "4911_00001", "4911_00001", "4911_00001", "4911_00001", 
"4911_00001", "4911_00001", "4911_00001", "4913_00001", "4913_00001", 
"4913_00001", "4913_00001", "4913_00001", "4913_00001", "4913_00001", 
"4913_00001", "4913_00001", "4913_00001", "4913_00001", "4913_00001", 
"4914_00001", "4914_00001", "4914_00001", "4914_00001", "4914_00001", 
"4914_00001", "4914_00001", "4914_00001", "4914_00001"), label = "Subject Identifier", format.sas = "$"), 
    variable = structure(c("IGF", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", 
    "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", 
    "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", 
    "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", 
    "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "GHR", "GHR", "IGF", 
    "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", 
    "IGF", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", "GHR", 
    "GHR", "IGF", "IGF", "IGF", "IGF", "IGF", "IGF", "GHR", "GHR", 
    "GHR", "GHR", "GHR", "GHR", "IGF", "IGF", "IGF", "IGF", "GHR", 
    "GHR", "GHR", "GHR", "GHR"), label = "Parameter", format.sas = "$"), 
    avisit = structure(c(1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 
    1, 2, 3, 4, 1, 3, 3, 4, 1, 3, 3, 4, 1, 2, 3, 4, 1, 2, 3, 
    4, 1, 2, 3, 1, 2, 3, 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 
    3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 3, 2, 2, 3, 1, 2, 3, 4, 1, 
    2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 5, 6, 1, 2, 
    3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 1, 2, 3, 
    4, 5, 1, 2, 3, 4, 5, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 
    1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 2, 3, 4, 5, 5, 
    6, 1, 2, 2, 3, 4, 5, 5, 6, 1, 2, 2, 3, 4, 4, 4, 4, 6, 1, 
    2, 2, 3, 4, 4, 4, 4, 6, 1, 2, 2, 3, 4, 1, 2, 2, 3, 4, 1, 
    2, 3, 4, 1, 2, 3, 4, 1, 3, 4, 5, 6, 1, 3, 4, 5, 6, 1, 2, 
    3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 3, 
    1, 2, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 4, 1, 2, 4, 1, 2, 
    3, 1, 2, 3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 1, 
    2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 3, 5, 6, 1, 2, 3, 5, 6, 
    1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 1, 2, 2, 4, 4, 
    1, 2, 2, 4, 1, 2, 3, 4, 4, 1, 2, 3, 4, 4, 1, 2, 3, 1, 2, 
    3, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 
    3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 4, 
    1, 2, 4, 1, 2, 2, 3, 1, 2, 2, 3, 1, 2, 2, 3, 5, 1, 2, 3, 
    5, 1, 3, 3, 4, 1, 3, 3, 4, 1, 2, 3, 3, 5, 1, 2, 3, 3, 5, 
    1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 3, 1, 2, 3, 1, 2, 3, 
    4, 5, 5, 1, 2, 3, 4, 5, 5, 1, 2, 4, 1, 2, 4, 1, 2, 3, 1, 
    2, 3, 1, 2, 3, 4, 4, 1, 2, 3, 4, 4, 1, 2, 3, 4, 1, 2, 3, 
    1, 1, 2, 2, 2, 3, 4, 1, 1, 2, 2, 3, 4, 1, 2, 2, 1, 2, 2, 
    1, 2, 3, 4, 4, 5, 1, 2, 3, 4, 5, 5, 1, 2, 3, 4, 5, 1, 2, 
    3, 4, 5, 1, 2, 2, 3, 4, 1, 2, 2, 3, 4, 1, 2, 3, 4, 4, 5, 
    1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 1, 
    2, 2, 3, 3, 3, 4, 4, 1, 2, 2, 3, 3, 3, 4, 4, 1, 2, 3, 4, 
    5, 1, 2, 3, 4, 5, 1, 2, 3, 1, 2, 3, 1, 2, 3, 4, 5, 1, 2, 
    3, 4, 5, 1, 3, 4, 1, 3, 4, 1, 2, 3, 3, 4, 1, 2, 3, 3, 4, 
    1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 4, 1, 2, 3, 
    4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 
    3, 1, 2, 3, 1, 2, 3, 3, 1, 2, 3, 3, 1, 2, 3, 4, 5, 1, 2, 
    3, 4, 5, 1, 2, 2, 4, 5, 1, 2, 4, 5, 1, 2, 3, 4, 5, 1, 3, 
    4, 5, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 1, 2, 2, 
    3, 4, 1, 2, 2, 4, 1, 2, 2, 2, 2, 3, 1, 2, 2, 2, 2, 3, 1, 
    2, 2, 2, 3, 4, 4, 5, 1, 2, 2, 2, 3, 4, 4, 5, 1, 2, 2, 3, 
    1, 2, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 4, 5, 1, 2, 3, 4, 
    5, 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 6, 1, 2, 
    3, 4, 5, 6, 1, 2, 3, 3, 5, 1, 2, 3, 3, 5, 1, 2, 3, 4, 5, 
    1, 2, 3, 4, 4, 5, 1, 2, 3, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 
    1, 2, 2, 2, 2, 3, 3, 3, 3, 5, 5, 1, 2, 2, 2, 2, 3, 3, 5, 
    5, 1, 2, 2, 2, 2, 2, 3, 1, 2, 2, 2, 2, 3, 1, 2, 3, 4, 5, 
    1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 1, 2, 
    3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 
    4, 1, 4, 1, 3, 3, 4, 1, 3, 3, 4, 1, 2, 3, 1, 2, 3, 1, 2, 
    4, 5, 1, 2, 4, 5, 1, 2, 3, 4, 4, 5, 5, 6, 1, 2, 3, 4, 4, 
    5, 5, 6, 1, 2, 2, 2, 3, 3, 4, 1, 2, 2, 2, 3, 4, 1, 2, 3, 
    4, 5, 5, 6, 6, 1, 2, 3, 4, 5, 5, 6, 6, 1, 2, 2, 3, 4, 5, 
    1, 2, 2, 3, 4, 5, 1, 3, 3, 4, 1, 3, 3, 4, 1, 3, 1, 3, 1, 
    2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 
    1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 
    4, 1, 2, 3, 4, 1, 2, 3, 3, 4, 5, 1, 2, 3, 3, 4, 5, 1, 2, 
    3, 4, 1, 2, 3, 3, 4), label = "Analysis Visit Window (N)"), 
    value = structure(c(571, 171, 179, 198, NA, 0.1, 0.1, 0.1, 
    260, 217, NA, 107, 2.3, 0.94, 0.9, 1, 865, 905, NA, NA, NA, 
    40.1, NA, NA, 144, 149, 149, 138, 1.1, 1.1, 0.4, 0.4, 152, 
    125, 115, 9.2, 0.5, 0.4, 212, 188, 252, 320, 290, 26, NA, 
    1.6, 1.8, 1.6, 429, 225, 92.6, 163, 218, 0.5, 0.19, 0.1, 
    0.4, 0.03, 457, 449, 536, 1.2, 1.1, 1.4, 329, 308, 355, 361, 
    2.4, 1.4, 2.4, 1.1, 427, 157, 123, 130, 8.07, 1.4, 0.68, 
    0.74, 936, 144, 108, 90.3, 61.2, 56.9, 6.2, 1.9, 1.9, 0.9, 
    0.8, 0.8, 701, 158, 114, 122, 173, 136, 2.1, 0.1, 0.2, 0.5, 
    0.4, 0.3, 295, 368, 260, 166, 177, 1.3, 1.4, 2.3, 2.5, 1.6, 
    542, 73.5, 106, 106, 6.3, 0.3, 0.4, 0.7, 170, 80.3, 98.7, 
    NA, 3.2, 0.3, 0.3, NA, 241.9, 166.9, 91.2, 125, 1.69, 0.6, 
    0.5, 0.79, 11.9, 210, 263, 294, 273, 34.2, 251, 260, 6.2, 
    1.8, 1.6, 1.7, 1.4, 0.9, 1.1, 1.3, NA, 179, 137, 263, 185, 
    185, 185, 282, 219, NA, 3.9, 4.4, 2.2, 3.2, 3.2, 3.2, 2.3, 
    2.5, 182, 155, 206, 174, 188, 2, 0.9, 0.7, 0.6, 0.9, 257, 
    NA, NA, 151.1, 2.39, NA, NA, NA, 235, 123, 102, 116.1, NA, 
    1.3, 2.54, NA, NA, NA, 514, 151, 173, NA, 1.68, 0.38, NA, 
    NA, 525, 74, 329, NA, 147.5, NA, NA, 1.41, NA, 0.4, 623, 
    NA, 424, 1.94, NA, 4.55, 249, 260, 324, 238.2, NA, NA, 0.87, 
    1.4, 319, 261.6, NA, NA, 0.9, NA, NA, 211, 130, NA, NA, 0.54, 
    346, 243.3, 273.7, 266.4, NA, NA, 0.2, 0.7, 643, 320.1, 348.9, 
    4.9, 1.3, 0.7, 900, 500, NA, 209, 197.8, 30, 22.5, NA, 1.7, 
    0.7, 651, NA, 195, NA, NA, 6.06, NA, 3.17, NA, NA, NA, 107, 
    156, NA, NA, 0.17, NA, NA, NA, 203, 258, NA, NA, NA, 590, 
    540, 457, 359, 451, 4.8, 2.83, 8.7, 2.5, 260, 212, 223, 201, 
    183, 0.63, 1.74, 0.71, 1.07, NA, 320, 339, 212, 2.92, 1.21, 
    NA, 226, 46, 99, 102, 1.79, 0.2, 0.29, 0.78, 278, 163, 181, 
    167, 0.5, 0.17, 0.209, 0.2, 585, 170, 178, 117, 5.05, 1.329, 
    2.75, NA, 339, 248, 338, 201, 258, 1.7, 3.1, 2.9, 1.45, 1.23, 
    268, 160, 227, NA, NA, 1.258, 334, 353, 226, 241, NA, 3.15, 
    3.74, 3.13, 185, 224, 169, 112, 149, 0.74, 0.51, NA, NA, 
    279.8, 333.6, 331, 281.4, 80, 1.45, 1, 0.78, 369, NA, 212, 
    305, 205, 1.56, NA, 0.59, 0.701, 0.62, 614, 506, 465, 442, 
    412, 3.87, 1.87, 6.21, NA, NA, 48.6, 28.8, 21.7, 1.44, 0.63, 
    0.31, 560.5, 218.6, 265.8, 323.8, 187, 269, 24.8, NA, 6.82, 
    1.99, 2.09, 3.78, 512.9, 420.7, 417.5, 0.8, 2.8, 2.2, 410, 
    387, 332, 0.005, 0.74, 0.7, 347, 191, 218, 266, 356, 1.6, 
    1.5, 1.96, 2.71, 2.7, 499, 229, 195, 187, 2.6, 0.2, NA, 232, 
    NA, 109, 156, NA, 160, 181, 2.14, NA, NA, NA, 0.66, 1.34, 
    300, NA, 69.9, 3.8, NA, 0.96, 496, 348, 336, 302, 343, 350, 
    11.5, 6.15, 4.79, 5.2, 3.6, 5.2, 222, 124, 135, 113, 123, 
    0.97, 0.59, NA, 0.39, 0.41, 218, 70.6, 76.4, 85.3, 83.1, 
    4.74, 1.08, 0.482, 0.448, 0.508, 1316, 205, 304, 79, NA, 
    98, 9.2, NA, NA, NA, 1063, 954, NA, 217, 3.2, 3.7, NA, NA, 
    444, 316, 311, 1.6, 0.4, 1.3, 368, 390, 440, 442, 419, 465, 
    441, 309, 19.3, 7.26, 9.74, 6.53, 6, 7.06, 4.97, NA, 228, 
    211, 139, 156, 130, 1.86, 1.28, 1.53, 1.28, 1.08, 414, 207, 
    199, 7.73, 3.27, 1.63, 204, 173, 255, 207, 223, 1.42, 0.15, 
    1.16, 2.17, 1.5, 431, 183, 253, 1.78, 0.84, 1.28, 616, 703, 
    499, 637, 289, 7.6, 7.3, 6.5, 8.4, 9.2, 306, 57, 89, NA, 
    NA, NA, 174, 100, 116, 0.5, 0.19, 0.27, 690.7, 388.1, 352, 
    288.4, 80, 3.16, 2.52, 1.43, 435.7, 209, 309.8, 227, 2.38, 
    0.51, 0.48, 0.39, 380.7, 216.5, 166, 152, 80, 0.59, 0.63, 
    0.57, 517.9, 420.8, 469, 80, 1.38, 1.55, 285.4, 381.4, 387, 
    390.2, 2.21, 1.2, 1.04, NA, 771, 336, 105.7, 186.6, 281, 
    6.986, 1.261, 1.86, 1.96, 19.99, 380.7, 117.5, 104.2, 80.6, 
    94.7, NA, NA, NA, NA, 221.6, 113.4, 138.3, 159.5, 176.6, 
    NA, NA, 0.81, 0.6, 390.9, 289.1, 270, 286.8, NA, NA, NA, 
    NA, NA, 314.4, 270.8, NA, NA, NA, 404.1, 176, 118.2, 107.7, 
    200.5, NA, 0.45, NA, NA, 205.1, 186.4, 309.3, 274.8, 264.4, 
    122.4, 0.78, 0.81, 1.01, 0.88, 1.28, 0.78, 252.9, 203.6, 
    178.6, 165, 211.1, 195, 206.3, 143.1, 0.25, 0.13, 0.11, 0.14, 
    0.1, 0.13, 0.09, 0.14, 668, 553.3, 587.9, 305.8, 5.92, 1.77, 
    2.1, 5, 358, 198, 198, 2.59, 1.32, 0.84, 205, 47.26, 76.53, 
    115.2, 145.3, 0.6, 0.13, 0.24, 0.89, 0.36, NA, 224, 312.8, 
    361, 268.3, NA, 59.1, 80, 80, 63.6, 401, 228, 189, 133, 149, 
    209, 3.37, 1.29, 1.75, 1.2, 1.43, 1.15, 604, 603, 581, 425, 
    287, 11.5, 6.44, 3.91, 5.96, 2.32, 150, 68, NA, NA, 78, 0.75, 
    0.78, NA, 0.45, NA, 0.44, 268, NA, 111, 118, 108, NA, 76, 
    1.2, NA, NA, 0.3, NA, 0.4, 801, 358, 372, 293, 338, 339, 
    293, 294, 331, 213, 288, 4.4, 0.91, 1.05, 0.68, 1.07, 0.69, 
    NA, 0.49, 0.68, 475, 556, 520, 356, 296, 431, 247, 4.7, 5.2, 
    4, 4.1, NA, 1.01, 416, 348, 312, 207, 194, 2.8, 1.2, 1, 0.6, 
    0.9, 234, 95, 13.9, 108, 91.6, 98.5, 2.8, 1.6, 1.8, 1.8, 
    1.4, 1.7, 307, 155, 108, 149, 178.6, NA, NA, 0.99, 1.5, 1.5, 
    67.1, 158, 216, 166, 199, 2.7, 0.21, 0.49, 0.17, 0.24, 43.3, 
    13.8, 5, 1.8, 27.6, 23.4, 22.4, 23.7, 1.6, 2, NA, 3.1, 35.9, 
    30.7, 32.2, 8.3, 7.8, 4.9, 182, 140, 215, 227, NA, 1.2, 1.4, 
    NA, 648, 237, 200, 297, 188, 212, 343, NA, 16.1, 2.3, 16.4, 
    4.1, 8.1, 3.7, 5.9, NA, 147, 143, 225, 155, 139, 134, 230, 
    0.88, 0.76, 1.78, 0.56, 0.4, 0.84, 338, 295, 252, 207, 168, 
    152, 184, 157, 0.81, 0.41, 1.7, 0.34, 0.6, 0.36, 0.41, 0.58, 
    477, 297, 219, 189, 155, 97, 6.4, 2.7, 3, 1.9, 3.2, 3.1, 
    313, 217, 196, 202, NA, NA, 0.2, NA, 196, 213, NA, NA, 351.6, 
    223.8, 355.1, 372.8, NA, NA, 1.689, 1.8, 463.7, 336, 330.6, 
    1.71, 0.864, NA, 244.3, 166.6, 138.6, 1.14, 0.386, 0.209, 
    178, 423, 343, 328, 14.07, 0.348, 0.552, 0.375, 256, 115, 
    NA, 186, 1.12, 0.248, NA, 0.745, 628.7, 516.7, 495.7, 646.8, 
    28.07, 20.48, 26.57, 19.38, 64.2, 58, 76.6, 71.5, 82.6, 49.4, 
    NA, 5.32, NA, 4.93, 3.2, 3.37, 641.3, 355.5, 492.5, 398.2, 
    13.64, 1.64, 3.82, 2.42, 3.22), label = "Laboratory result")), .Names = c("usubjid", 
"variable", "avisit", "value"), row.names = c(NA, -1026L), class = c("tbl_df", 
"tbl", "data.frame"))

---
title: "ACRONIS outputs mean and 95% confidence intervals toGPS
"
author: "Eamonn O'Brien"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  html_document: default
  pdf_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 8
    number_sections: no
  word_document: default
header-includes:
- \usepackage{eso-pic,graphicx,transparent}
- \usepackage{graphicx}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \setlength\headheight{22pt}
- \fancyfoot[RO]{Novartis IGE025E3401 AWARE}
- \usepackage{lastpage}
- \cfoot{Page \thepage\ of \pageref{LastPage}}
---


\AddToShipoutPictureFG{
  \AtPageCenter{% or \AtTextCenter
    \makebox[0pt]{\rotatebox[origin=c]{45}{%
      \scalebox{5}{\texttransparent{0.3}{ }}%
    }}
  }
}



```{r set-options, echo=FALSE, cache=FALSE, warning = FALSE}

#/***************************************************************************#
#Filename           :      Acronis.Rmd
#Author             :      obrieea1
#Date               :      xx-xx-xxxx
#R                  :      3.2.3 (2015-12-10) 
#Platform           :      x86_64-pc-linux-gnu (64-bit) 
#Project/Study      :      CIGE025AMX02
#Description        :      xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
#Assumptions:   
#Input              :         
#Output             :      
#Macros used        :       
#---------------------------------------------------------------------------
#MODIFICATION HISTORY: 
#    <DD-MON-YYYY>,
#    <Description> 
#    
#***************************************************************************/

        rm(list=ls())

        set.seed(123)
        startTime<-proc.time()
        library(knitr)
        options(width=120)
        opts_chunk$set(comment = "", warning = FALSE, message = FALSE,
                       echo = FALSE, tidy = FALSE, size="tiny",  cache=FALSE,
                       progress=TRUE,
                         fig.width=7, fig.height=3.5,
                       cache.path = 'program_Cache/',
                       fig.path='figure/')
         
        knitr::knit_hooks$set(inline = function(x) {
          knitr:::format_sci(x, 'md')
        })
         
        
        # create an R file of the code!
        # https://stackoverflow.com/questions/26048722/knitr-and-tangle-code-without-execution
        
         knit_hooks$set(purl = function(before, options) {
           if (before) return()
           input  = current_input()  # filename of input document
           output = paste(tools::file_path_sans_ext(input), 'R', sep = '.')
           if (knitr:::isFALSE(knitr:::.knitEnv$tangle.start)) {
           assign('tangle.start', TRUE, knitr:::.knitEnv)
           unlink(output)
         }
           cat(options$code, file = output, sep = '\n', append = TRUE)
         })

   
     #   list.of.packages <- c("tidyverse")  # haven causes a problem
        
     #   new.packages <- list.of.packages[!(list.of.packages %in% 
# installed.packages()[,"Package"])]
     #   if(length(new.packages)) install.packages(new.packages)
     #    sapply(X = list.of.packages, require, character.only = TRUE)

```  

### Introduction

```{r}

cat("\nDatasets starting with c3 are from the ‘MEXIC codificado 03Ago2017 con AEs & SAEs.xlsx’ MS Excel Workbook. Those starting with X_ (63+1 frm Erasmo) are from the supplied xlsx workbook original Spanish and those without underscore are the translated to English versions (63+1 from Erasmo) \n")

```

### Contents

```{r}

cat("\  \n")

```


```{r, parameters}
 

```

### Directories

```{r, echo=TRUE}

      # MODESIM directories
      wd <- Rhome <-'/home/obrieea1/Documents/ACRONIS/'
      wd.code <- paste0(Rhome,'')                    # note this new dir
      wd.data <- paste0(Rhome,'DATA')
 
      # GPS directories
      gps <- '/view/obrieea1_view/vob/CSOM230C/CSOM230CIC05/csr_2/'
      path.script <- paste0(gps, 'pgm/eff/')            # are these correct?
      path.import <- paste0(gps, 'analysis_data/')       # here are the data
      path.export <- paste0(gps, 'reports/eff/')
      
      
      temp <- "G:/BusUnits/BSC/SSP/Data Science/Statistics/Clinical Trials/CSOM230CIC05 (ACRONIS)/R"
 
      # rounding functions
      p2 <- function(x) {formatC(x, format="f", digits=2)}
      p3 <- function(x) {formatC(x, format="f", digits=3)}
      p4 <- function(x) {formatC(x, format="f", digits=4)}
     
     # function to calculate the mode     
          getmode <- function(v) {
               uniqv <- unique(v)
               uniqv[which.max(tabulate(match(v, uniqv)))]
          }
 
       
        #perhaps help colour plot text based on loop count
        is.even <- function(x){ x %% 2 == 0 }
           
        options(width=90)
  
```

### Import all SAS files

```{r, echo=TRUE, eval=TRUE}


     setwd(path.import)                      # point to GPS II project SAS datasets folder 
     # temp = list.files(pattern="*.sas7bdat") # get all the SAS dataset names into this object
     temp = list.files(pattern="*.sas") 
     # x <- haven::read_sas(temp[2])   # this seems to work for "_alergiamedicamentos_descrip.sas7bdat" ?
     for (i in 1:length(temp)) assign(temp[i], haven::read_sas(temp[i]))  # read in all the SAS files from GPS
     setwd(wd.code)                          # revert back to this directory
     
     
     
```

### SAS data sets in working environment

```{r, echo=FALSE}
       
  x <- grep("sas7bdat", ls())  # grab objects with this phrase, next line put them in object
  SAS <- ls()[x]
  
```

# The itt pop

```{r itt}
  
  foo <- aigf.sas7bdat  # pull in the data
  
  dim(foo)
  length(unique(foo$SID1A)) # number of patients


  
  
```

# Plots with visit taken from aware f_14.2-1.29 Bayesian.Rmd


```{r bivariate with visit}

 # summary stats
 # dropping this variable only  


   mdata1 <- foo
   df <- mdata1
   df$variable <- df$PAR_1C #PAR_1C
   df$value <- df$LABRSL1N #PAR_1C
   df$avisit <- df $AVISITN
   df$usubjid <- df$SID1A
   df <- df[, c("usubjid", "variable","avisit","value")]

  require(dplyr)
  df_summary <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value)))) # SE of each group

  # summary
  df_summary
  
  
  

  df_summary1 <- merge(df, df_summary)  # merge stats to dataset
  
  # dont want error bars to exceed plausible range
  df_summary1$L2SE <- df_summary1$mean_PL - 2*df_summary1$SE_PL
  df_summary1$H2SE <- df_summary1$mean_PL + 2*df_summary1$SE_PL
  
  df_summary1$H2SE <- ifelse(df_summary1$H2SE > 100, 100, df_summary1$H2SE)
  df_summary1$L2SE <- ifelse(df_summary1$L2SE < 0, 0,     df_summary1$L2SE)
  
require(ggplot2)
  pr1 <- ggplot((df_summary1), aes(x = avisit, y =value, color = usubjid)) +
    geom_line( size=.5, alpha=0.2) +
    stat_summary(geom="line",  fun.y=mean, colour="black", lwd=0.5) +  # , linetype="dashed"
    stat_summary(geom="point", fun.y=mean, colour="black") +
    geom_errorbar(data=(df_summary1), 
                  aes( ymin=L2SE, ymax=H2SE ), color = "black",
                  width=0.05, lwd = 0.05) +
    #theme(axis.title.y=element_text(margin=margin(0,20,0,0))) +
    scale_y_continuous(expand = c(.1,0)) +
        
    scale_x_continuous(breaks = c(unique(df$avisit)),
                       labels = 
                         c(unique(df$avisit))
                       ) +
    
    theme(legend.position="none") +
    facet_wrap(~variable, ncol=3, scales = "free") +
    EnvStats::stat_n_text(size = 4, y.pos = NULL , y.expand.factor=0, 
                          angle = 0, hjust = .5, family = "mono", fontface = "plain") #295 bold
  
   print(pr1 + labs(y="Response", x = "Months from baseline visit") + 
          ggtitle("Individual responses & Mean Response ± 2 SE shown in black\nNumber of values at each time point shown above x axis") )
  
   
   
   
   # summary stats again
   
cat("Summary stats by visit\n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Month","Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
    

cat("Summary stats overall (univariate) \n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
      
  
  
```

# try non facetted plot IGF only

```{r}



    

   mdata1 <- foo
   df <- mdata1
   df$variable <- df$PAR_1C #PAR_1C
   df$value <- (df$LABRSL1N) #PAR_1C
   df$avisit <- df $AVISITN
   df$usubjid <- df$SID1A
   
   
   #df <- df[df$variable %in% "GHR",]
   df <- df[df$variable %in% "IGF",]
   
 # df$value <- log(df$value)

  require(dplyr)
  df_summary <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value)))) # SE of each group

   df_summary
   #df_summary <- data.frame(df_summary[,1:2], apply(df_summary[,3:6], 2, log))
  
   df_summary1 <- merge(df, df_summary)  # merge stats to dataset
  
  # dont want error bars to exceed plausible range
  df_summary1$L2SE <- df_summary1$mean_PL - 2*df_summary1$SE_PL
  df_summary1$H2SE <- df_summary1$mean_PL + 2*df_summary1$SE_PL
  
 df_summary1$H2SE <- ifelse(df_summary1$H2SE > 100, 100, df_summary1$H2SE)
  df_summary1$L2SE <- ifelse(df_summary1$L2SE < 0, 0,     df_summary1$L2SE)
  

  pr1 <- ggplot((df_summary1), aes(x = avisit, y =value, color = usubjid)) +
    geom_line( size=.5, alpha=0.2) +
    stat_summary(geom="line",  fun.y=mean, colour="black", lwd=0.5) +  # , linetype="dashed"
    stat_summary(geom="point", fun.y=mean, colour="black") +
    geom_errorbar(data=(df_summary1), 
                  aes( ymin=L2SE, ymax=H2SE ), color = "black",
                  width=0.05, lwd = 0.05) +
    #theme(axis.title.y=element_text(margin=margin(0,20,0,0))) +
     scale_y_continuous(expand = c(.1,0) ) +
        
    #coord_trans(y = "log2") +
    
      #scale_y_continuous(  trans='log') +
    
    scale_x_continuous(breaks = c(unique(df$avisit)),
                       labels = 
                         c(unique(df$avisit))
                       ) +
    
    theme(axis.text.y   = element_text(size=10),
        axis.text.x   = element_text(size=10),
        axis.title.y  = element_text(size=14),
        axis.title.x  = element_text(size=14),
        panel.background = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        legend.position="none",
        legend.text=NULL,
        legend.title=NULL,
        axis.line = element_line(colour = "black", size=0.05),
        panel.border = element_rect(colour = "black", fill=NA, size=0.05)
  ) +
    
    EnvStats::stat_n_text(size = 4, y.pos = max(df_summary1$value, na.rm=T)*1.1 , y.expand.factor=0, 
                          angle = 0, hjust = .5, family = "mono", fontface = "plain") #295 bold
  
   print(pr1 + labs(y="IGF ng/mL", x = "Visit") + 
          ggtitle("Individual responses & mean response ± 2 SE shown in black\nNumber of patient values at each time point") )
   
cat("Summary stats by visit\n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Month","Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
    

cat("Summary stats overall (univariate) \n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
      
    
    
    
    
    
```

# Log GH plot using non gplot methods

```{r}
    
   
    

    mdata1 <- foo
    df <- mdata1
    
    
    
    
    
  # drops <- c("paramn")
   #mdata1 <- mdata[ , !(names(mdata) %in% drops)]

   # mdata1 <- na.omit(mdata1)

  # df <- reshape::melt.data.frame(mdata1, 
         #   id.vars = c("usubjid","avisit","hrcucat")) # for ggplotot

  #df <- droplevels(df)

   
   df$variable <- df$PAR_1C #PAR_1C
   df$value <- (df$LABRSL1N) #PAR_1C
   df$avisit <- df $AVISITN
   df$usubjid <- df$SID1A
   
   
   #df <- df[df$variable %in% "GHR",]
   df <- df[df$variable %in% "GHR",]
   
   
     require(dplyr)
   
    # do the calculation before
    orig.scale <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value)))) # SE of each group
   
   
  df$value <- log(df$value)  #log the GH values


  est <- df_summary <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value)))) # SE of each group

  
   #df_summary <- data.frame(df_summary[,1:2], apply(df_summary[,3:6], 2, log))
  
   df_summary1 <- merge(df, df_summary)  # merge stats to dataset
  
  # dont want error bars to exceed plausible range
  df_summary1$L2SE <- df_summary1$mean_PL - 2*df_summary1$SE_PL
  df_summary1$H2SE <- df_summary1$mean_PL + 2*df_summary1$SE_PL
  
 df_summary1$H2SE <- ifelse(df_summary1$H2SE > 100, 100, df_summary1$H2SE)
  df_summary1$L2SE <- ifelse(df_summary1$L2SE < 0, 0,     df_summary1$L2SE)
  

  pr1 <- ggplot((df_summary1), aes(x = avisit, y =value, color = usubjid)) +
    geom_line( size=.5, alpha=0.2) +
    stat_summary(geom="line",  fun.y=mean, colour="black", lwd=0.5) +  # , linetype="dashed"
    stat_summary(geom="point", fun.y=mean, colour="black") +
    geom_errorbar(data=(df_summary1), 
                  aes( ymin=L2SE, ymax=H2SE ), color = "black",
                  width=0.05, lwd = 0.05) +
    #theme(axis.title.y=element_text(margin=margin(0,20,0,0))) +
     scale_y_continuous(expand = c(.1,0) ) +
        
    #coord_trans(y = "log2") +
    
    #scale_y_continuous(  trans='log') +
    
    scale_x_continuous(breaks = c(unique(df$avisit)),
                       labels = 
                         c(unique(df$avisit))
                       ) +

 

    # scale_y_continuous(breaks= c(1,2,3,4,5,10,50  ) ,
   #                     labels=c(log(1),log(2), log(3), log(4), log(5), log(10), log(50))) +
    
    
    scale_y_continuous(
      breaks= 
    c( log(0.01),log(0.05), log(0.2) ,   log(1), log(2.5),  log(7.5),  
       log(20 ),log(50) , log(100) ) ,  # this is where the values go
      labels=    c(0.01, 0.05, 0.2 , 1, 2.5,7.5,20, 50 , 100)) +      # this what appears
                          
    # geom_hline(yintercept=log(1),   linetype="dashed", color = "blue", size=0.2) +
    # geom_hline(yintercept=log(2.5), linetype="dashed", color = "blue", size=0.2) +
   
    
    geom_segment(aes(x = 1, xend = 3, y = log(1), yend=log(1)), color = "blue" , size=0.05, linetype="dashed", alpha=0.02) +
        geom_segment(aes(x = 1, xend = 3, y = log(2.5), yend=log(2.5)), color = "blue" , size=0.05, linetype="dashed", alpha=0.02) +
    
    theme(axis.text.y   = element_text(size=10),
        axis.text.x   = element_text(size=10),
        axis.title.y  = element_text(size=14),
        axis.title.x  = element_text(size=14),
        panel.background = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        legend.position="none",
        legend.text=NULL,
        legend.title=NULL,
        axis.line = element_line(colour = "black", size=0.05),
        panel.border = element_rect(colour = "black", fill=NA, size=0.05)
  ) +
    
    EnvStats::stat_n_text(size = 4, y.pos = max(df_summary1$value, na.rm=T)*1.1 , y.expand.factor=0, 
                          angle = 0, hjust = .5, family = "mono", fontface = "plain") #295 bold
  
   print(pr1 + labs(y="GH", x = "Visit") + 
          ggtitle("Individual responses & mean response ± 2 SE shown in black\nNumber of patient values at each time point") )
   
   
   ####
   
  est$L2SE <- est$mean_PL - 2*est$SE_PL
  est$H2SE <-est$mean_PL + 2*est$SE_PL
  
  
  #food2 <- data.frame(est)
  
  food2 <- data.frame( est[,c(1,2,5)],  apply(est[,c(3,4,6,7,8)],2, exp))
  
  
    names(food2) <- c("Month","Variable","N","Mean", "SD","SE", "low", "high")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
   ###
   
   
   
   
   
   
   
   
cat("Summary stats by visit\n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Month","Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
    

cat("Summary stats overall (univariate) \n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
      
    
    
    
     
    
    
    
    
    
    
  
    
```

#  GH plot on original scale

```{r}
    
   
    

    mdata1 <- foo
    df <- mdata1
    
    
    
    
    
  # drops <- c("paramn")
   #mdata1 <- mdata[ , !(names(mdata) %in% drops)]

   # mdata1 <- na.omit(mdata1)

  # df <- reshape::melt.data.frame(mdata1, 
         #   id.vars = c("usubjid","avisit","hrcucat")) # for ggplotot

  #df <- droplevels(df)

   
   df$variable <- df$PAR_1C #PAR_1C
   df$value <- (df$LABRSL1N) #PAR_1C
   df$avisit <- df $AVISITN
   df$usubjid <- df$SID1A
   
   
   #df <- df[df$variable %in% "GHR",]
   df <- df[df$variable %in% "GHR",]
   
   
     require(dplyr)
   
  
  #df$value <- log(df$value)  #log the GH values


  df_summary <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value)))) # SE of each group

  
   #df_summary <- data.frame(df_summary[,1:2], apply(df_summary[,3:6], 2, log))
  
   df_summary1 <- merge(df, df_summary)  # merge stats to dataset
  
  # dont want error bars to exceed plausible range
  df_summary1$L2SE <- df_summary1$mean_PL - 2*df_summary1$SE_PL
  df_summary1$H2SE <- df_summary1$mean_PL + 2*df_summary1$SE_PL
  
 df_summary1$H2SE <- ifelse(df_summary1$H2SE > 100, 100, df_summary1$H2SE)
  df_summary1$L2SE <- ifelse(df_summary1$L2SE < 0, 0,     df_summary1$L2SE)
  

  pr1 <- ggplot((df_summary1), aes(x = avisit, y =value, color = usubjid)) +
    geom_line( size=.5, alpha=0.2) +
    stat_summary(geom="line",  fun.y=mean, colour="black", lwd=0.5) +  # , linetype="dashed"
    stat_summary(geom="point", fun.y=mean, colour="black") +
    geom_errorbar(data=(df_summary1), 
                  aes( ymin=L2SE, ymax=H2SE ), color = "black",
                  width=0.05, lwd = 0.05) +
    #theme(axis.title.y=element_text(margin=margin(0,20,0,0))) +
     scale_y_continuous(expand = c(.1,0) ) +
        
    #coord_trans(y = "log2") +
    
    #scale_y_continuous(  trans='log') +
    
    scale_x_continuous(breaks = c(unique(df$avisit)),
                       labels = 
                         c(unique(df$avisit))
                       ) +

 

    # scale_y_continuous(breaks= c(1,2,3,4,5,10,50  ) ,
   #                     labels=c(log(1),log(2), log(3), log(4), log(5), log(10), log(50))) +
    
    
    # scale_y_continuous(
    #   breaks= 
    # c( log(0.01),log(0.05), log(0.2) ,   log(1), log(2.5),  log(7.5),  
    #    log(20 ),log(50) , log(100) ) ,  # this is where the values go
    #   labels=    c(0.01, 0.05, 0.2 , 1, 2.5,7.5,20, 50 , 100)) +      # this what appears
                          
    # geom_hline(yintercept=log(1),   linetype="dashed", color = "blue", size=0.2) +
    # geom_hline(yintercept=log(2.5), linetype="dashed", color = "blue", size=0.2) +
   
    
    geom_segment(aes(x = 1, xend = 3, y = (1), yend=(1)), color = "blue" , size=0.05, linetype="dashed", alpha=0.02) +
        geom_segment(aes(x = 1, xend = 3, y = (2.5), yend=(2.5)), color = "blue" , size=0.05, linetype="dashed", alpha=0.02) +
    
    theme(axis.text.y   = element_text(size=10),
        axis.text.x   = element_text(size=10),
        axis.title.y  = element_text(size=14),
        axis.title.x  = element_text(size=14),
        panel.background = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        legend.position="none",
        legend.text=NULL,
        legend.title=NULL,
        axis.line = element_line(colour = "black", size=0.05),
        panel.border = element_rect(colour = "black", fill=NA, size=0.05)
  ) +
    
    EnvStats::stat_n_text(size = 4, y.pos = max(df_summary1$value, na.rm=T)*1.1 , y.expand.factor=0, 
                          angle = 0, hjust = .5, family = "mono", fontface = "plain") #295 bold
  
   print(pr1 + labs(y="GH", x = "Visit") + 
          ggtitle("Individual responses & mean response ± 2 SE shown in black\nNumber of patient values at each time point") )
   
   
   
   
   
   
cat("Summary stats by visit\n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Month","Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
    

cat("Summary stats overall (univariate) \n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
      
    
    
    
     
    
    
 


    
```

#  GH plot on original scale

```{r}
    
   
    

    mdata1 <- foo
    df <- mdata1
    
    
    
    
    
  # drops <- c("paramn")
   #mdata1 <- mdata[ , !(names(mdata) %in% drops)]

   # mdata1 <- na.omit(mdata1)

  # df <- reshape::melt.data.frame(mdata1, 
         #   id.vars = c("usubjid","avisit","hrcucat")) # for ggplotot

  #df <- droplevels(df)

   
   df$variable <- df$PAR_1C #PAR_1C
   df$value <- (df$LABRSL1N) #PAR_1C
   df$avisit <- df $AVISITN
   df$usubjid <- df$SID1A
   
   
   #df <- df[df$variable %in% "GHR",]
   df <- df[df$variable %in% "GHR",]
   
   
     require(dplyr)
   
  
  #df$value <- log(df$value)  #log the GH values


  df_summary <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value)))) # SE of each group

  
   #df_summary <- data.frame(df_summary[,1:2], apply(df_summary[,3:6], 2, log))
  
   df_summary1 <- merge(df, df_summary)  # merge stats to dataset
  
  # dont want error bars to exceed plausible range
  df_summary1$L2SE <- df_summary1$mean_PL - 2*df_summary1$SE_PL
  df_summary1$H2SE <- df_summary1$mean_PL + 2*df_summary1$SE_PL
  
 df_summary1$H2SE <- ifelse(df_summary1$H2SE > 100, 100, df_summary1$H2SE)
  df_summary1$L2SE <- ifelse(df_summary1$L2SE < 0, 0,     df_summary1$L2SE)
  

  pr1 <- ggplot((df_summary1), aes(x = avisit, y =value, color = usubjid)) +
    geom_line( size=.5, alpha=0.2) +
    stat_summary(geom="line",  fun.y=mean, colour="black", lwd=0.5) +  # , linetype="dashed"
    stat_summary(geom="point", fun.y=mean, colour="black") +
    geom_errorbar(data=(df_summary1), 
                  aes( ymin=L2SE, ymax=H2SE ), color = "black",
                  width=0.05, lwd = 0.05) +
    #theme(axis.title.y=element_text(margin=margin(0,20,0,0))) +
     scale_y_continuous(expand = c(.1,0) ) +
        
    #coord_trans(y = "log2") +
    
    #scale_y_continuous(  trans='log') +
    
    scale_x_continuous(breaks = c(unique(df$avisit)),
                       labels = 
                         c(unique(df$avisit))
                       ) +

 

    # scale_y_continuous(breaks= c(1,2,3,4,5,10,50  ) ,
   #                     labels=c(log(1),log(2), log(3), log(4), log(5), log(10), log(50))) +
    
    
    # scale_y_continuous(
    #   breaks= 
    # c( log(0.01),log(0.05), log(0.2) ,   log(1), log(2.5),  log(7.5),  
    #    log(20 ),log(50) , log(100) ) ,  # this is where the values go
    #   labels=    c(0.01, 0.05, 0.2 , 1, 2.5,7.5,20, 50 , 100)) +      # this what appears
                          
    # geom_hline(yintercept=log(1),   linetype="dashed", color = "blue", size=0.2) +
    # geom_hline(yintercept=log(2.5), linetype="dashed", color = "blue", size=0.2) +
   
    
    geom_segment(aes(x = 1, xend = 3, y = (1), yend=(1)), color = "blue" , size=0.05, linetype="dashed", alpha=0.02) +
        geom_segment(aes(x = 1, xend = 3, y = (2.5), yend=(2.5)), color = "blue" , size=0.05, linetype="dashed", alpha=0.02) +
    
    theme(axis.text.y   = element_text(size=10),
        axis.text.x   = element_text(size=10),
        axis.title.y  = element_text(size=14),
        axis.title.x  = element_text(size=14),
        panel.background = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        legend.position="none",
        legend.text=NULL,
        legend.title=NULL,
        axis.line = element_line(colour = "black", size=0.05),
        panel.border = element_rect(colour = "black", fill=NA, size=0.05)
  ) +
    
    EnvStats::stat_n_text(size = 4, y.pos = max(df_summary1$value, na.rm=T)*1.1 , y.expand.factor=0, 
                          angle = 0, hjust = .5, family = "mono", fontface = "plain") #295 bold
  
   print(pr1 + labs(y="GH", x = "Visit") + 
          ggtitle("Individual responses & mean response ± 2 SE shown in black\nNumber of patient values at each time point") )
   
   
   
   
   
   
cat("Summary stats by visit\n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Month","Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
    

cat("Summary stats overall (univariate) \n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
      
    
    
    
     
    
    
    
```

#  GH plot using ggplot to transform

```{r}
    
   
    mdata1 <- foo
    df <- mdata1
    
  

   
   df$variable <- df$PAR_1C #PAR_1C
   df$value <- (df$LABRSL1N) #PAR_1C
   df$avisit <- df $AVISITN
   df$usubjid <- df$SID1A
   
   
   #df <- df[df$variable %in% "GHR",]
   df <- df[df$variable %in% "GHR",]
   
   df$value2 <- log(df$value)  #new
     require(dplyr)
   
  
  #df$value <- log(df$value)  #log the GH values


  df_summary <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value2, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value2, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value2)),      # calculates the sample size per group
              SE_PL = sd(value2, na.rm=TRUE)/sqrt(length(na.omit(value2)))) # SE of each group

  
   #df_summary <- data.frame(df_summary[,1:2], apply(df_summary[,3:6], 2, log))
  
  
    
  df_summary$L2SE <- df_summary$mean_PL - 2*df_summary$SE_PL
  df_summary$H2SE <- df_summary$mean_PL + 2*df_summary$SE_PL
  df_summary
  
  df_summary1 <- merge(df, df_summary)  # merge stats to dataset
  
  # exp back transform
 
 

  #backtransform
 # df_summary1$mean_PL <-(df_summary1$mean_PL)
  #df_summary1$L2SE <-   (df_summary1$L2SE)
  #df_summary1$H2SE <-   (df_summary1$H2SE)

  
  
 #df_summary1$H2SE <- ifelse(df_summary1$H2SE > 100, 100, df_summary1$H2SE)
  #df_summary1$L2SE <- ifelse(df_summary1$L2SE < 0, 0,     df_summary1$L2SE)
  

  pr1 <- ggplot((df_summary1), aes(x = avisit, y =value, color = usubjid)) +
    geom_line( size=.5, alpha=0.2) +
    stat_summary(geom="line",  fun.y=mean, colour="black", lwd=0.5) +  # , linetype="dashed"
    stat_summary(geom="point", fun.y=mean, colour="black") +
    geom_errorbar(data=(df_summary1), 
                  aes( ymin=(L2SE), ymax=exp(H2SE) ), color = "black",
                  width=0.05, lwd = 0.05) +
    #theme(axis.title.y=element_text(margin=margin(0,20,0,0))) +
    # scale_y_continuous(trans = 'log2')  +
        
    #coord_trans(y = "log2") +
    
    scale_y_continuous(  trans='log10') +
    #coord_trans(ytrans = "log") +
    ylim(0,10)+
    scale_x_continuous(breaks = c(unique(df$avisit)),
                       labels = 
                         c(unique(df$avisit))
                       ) +

 
 
   
    
    geom_segment(aes(x = 1, xend = 3, y = (1), yend=(1)), color = "blue" , size=0.05, linetype="dashed", alpha=0.02) +
        geom_segment(aes(x = 1, xend = 3, y = (2.5), yend=(2.5)), color = "blue" , size=0.05, linetype="dashed", alpha=0.02) +
    
    theme(axis.text.y   = element_text(size=10),
        axis.text.x   = element_text(size=10),
        axis.title.y  = element_text(size=14),
        axis.title.x  = element_text(size=14),
        panel.background = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        legend.position="none",
        legend.text=NULL,
        legend.title=NULL,
        axis.line = element_line(colour = "black", size=0.05),
        panel.border = element_rect(colour = "black", fill=NA, size=0.05)
  ) +
    
    EnvStats::stat_n_text(size = 4, y.pos = max(df_summary1$value, na.rm=T)*1.1 , y.expand.factor=0, 
                          angle = 0, hjust = .5, family = "mono", fontface = "plain") #295 bold
  
   print(pr1 + labs(y="GH", x = "Visit") + 
          ggtitle("Individual responses & mean response ± 2 SE shown in black\nNumber of patient values at each time point") )
   
   
   
   
   
   
cat("Summary stats by visit\n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(avisit, variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Month","Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
    

cat("Summary stats overall (univariate) \n\n")
df_summaryx <- df %>% # the names of the new data frame and the data frame to be summarised
    group_by(variable) %>%                # the grouping variable
    summarise(mean_PL = mean(value, na.rm=TRUE),  # calculates the mean of each group
              sd_PL = sd(value, na.rm=TRUE),      # calculates the sd of each group
              n_PL = length(na.omit(value)),      # calculates the sample size per group
              SE_PL = sd(value, na.rm=TRUE)/sqrt(length(na.omit(value))), # SE of each group
              Ns=length(unique(usubjid)),   # unique subjects
              low = mean(value, na.rm=T) - qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              upp = mean(value, na.rm=T) + qt(.975, length(na.omit(value))-1)*(sd(value, na.rm=T)/ length(na.omit(value))^.5),
              median=median(value, na.rm=T) ,
              min = min(value, na.rm=T),  
              max = max(value, na.rm=T) ,
              MCID = sd(value, na.rm=T)/2,
              miss = sum(is.na(value))
  ) 

    food2 <- data.frame(df_summaryx)
    names(food2) <- c("Variable","Mean", "SD","N","SE","subjects", "low", "high", "Med", "Min","Max", "MCID", "NA")  
    print(kable(food2, format="pandoc", 
                row.names = FALSE, digits = c(3)))
      
    
    
    
     
    
    
    
    
```
    
# trying gls GH, gls does not cluster correctly so switch to random effects lme
 
```{r}
require(nlme)
#set.seed(123)
#y <- sample(1:99, size = 99, replace = TRUE, prob = 99:1) #rnorm(99,0,25)+23

    mdata1 <- foo
    df <- mdata1
    
  

   
   df$variable <- df$PAR_1C #PAR_1C
   df$value <- (df$LABRSL1N) #PAR_1C
   df$avisit <- df $AVISITN
   df$usubjid <- df$SID1A
   
   
   #df <- df[df$variable %in% "GHR",]
   df <- df[df$variable %in% "GHR",]
   df$x <- df$avisit
   df$y <- df$value
  df$g <- df$usubjid
  df<-df[df$ANL01FL %in% "Y",]  #otherwise miht have visit twice with persons

require(dplyr)
dfs<- df %>%
  group_by(x) %>%
  summarise(mu=mean(y,na.rm=T), sd=sd(y,na.rm=T), n=length(na.omit(y)), se=sd(y,na.rm=T)/sqrt(length(na.omit(y))),
            lo = mean(y,na.rm=T)-2*sd(y,na.rm=T)/sqrt(length(na.omit(y))),
            hi = mean(y,na.rm=T)+2*sd(y,na.rm=T)/sqrt(length(na.omit(y)) ))

dfs
df1 <- merge(df,dfs)

se<-function(x) { sd(x,na.rm=T)/sqrt(length(na.omit(x))) }

require(ggplot2)
ggplot(df1, aes(x=x, y=y, color=g)) +
  geom_line(size=.5, alpha=.2) + guides(color=FALSE) +
  stat_summary(geom="line", fun.y=mean, color="black", lwd=.5) +
  stat_summary(geom="point", fun.y=mean, colour="black", lwd=0.5) +
  stat_summary(fun.y=mean, fun.ymin=se, fun.ymax=se, colour="black", lwd=0.5) +
  geom_errorbar(data=df1, aes(ymin=lo, ymax=hi), color="black", width=.05, lwd=.5) #+
  #ylim(min(y),max(y)) #+
#scale_y_continuous(trans = "log")

 


####
require(rms)
#ddz <- datadist(df1)

f <-df1[,c("x","y","usubjid")]


f$g <- (f$usubjid)
f$x <- as.factor(f$x)

length(unique(f$g))
dim(f)

f<-plyr::arrange(f, g, x)

g<-f$g
g<-as.vector(g)
f$id<-rep(seq_along( rle(g)$values ), times = rle(g)$lengths )

dd <- datadist(f)
options(datadist='dd')
fh <- Gls(y ~ x ,
         correlation=corSymm(form=~ as.numeric(x)|id), 
         weights=varIdent(form=~1|x),
         f, na.action=na.omit)

intervals(fh, which='coef')

G <- length(unique(getData(fh)$g))
  N <- length(fh$groups)
  form <-fh$sformula

#require(nlme)
  
fh1 <- lme(y ~ x -1,
          correlation=corSymm(form=~ as.numeric(x)|id), random=~1|id,
          weights=varIdent(form=~1|x),
          f, na.action=na.omit)  
  
 i<- (intervals(fh1, which='fixed'))
i<-  as.data.frame(i$fixed)
i <-i[,c(2,1,3)]

#co<-(fixed.effects(fh1))
est <- as.data.frame(i)
names(est) <- c('Contrast', 'Lower', 'Upper')
est$x<-as.numeric(1:3)
#########################

#change

fh1 <- lme(y ~ x ,
          correlation=corSymm(form=~ as.numeric(x)|id), random=~1|id,
          weights=varIdent(form=~1|x),
          f, na.action=na.omit)  
  
 i<- (intervals(fh1, which='fixed'))
i<-  as.data.frame(i$fixed)
i <-i[,c(2,3,1)]



  
#########################  

length(unique(df1$g))

df1$x <- as.factor(df1$x)

#options(datadist='ddz')

a <- gls(y ~ x +0,
         correlation=corSymm(form=~ as.numeric(x)|g), 
         weights=varIdent(form=~1|x),
         df1, na.action=na.exclude)

intervals(a, which='coef')
confint(a)

summary(a)
#est <- as.data.frame(cbind(coef(a),confint(a)))
#names(est) <- c('Contrast', 'Lower', 'Upper')
#est$x<-as.numeric(1:3)
df$x <- as.numeric(df$x)





p <- ggplot(data = est, aes(x=x , y=Contrast, group=1)) +
  geom_point() + geom_line() +   guides(color=FALSE) +
  geom_errorbar(aes(ymin=Lower, ymax=Upper ), color="black", width=.05, lwd=.5) 
#scale_x_continuous(limits = c(1,3), expand = c(0.02, 0.02)) 

p0 <- p+  geom_line(data=df, aes(x = x, y = y, color = g, group=g),alpha=.4)  +
  theme(text = element_text(size=10),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))
#  scale_y_continuous(trans = "log")
p0



library(ggplot2)
library(scales)

#https://stackoverflow.com/questions/14255533/pretty-ticks-for-log-normal-scale-using-ggplot2-dynamic-not-manual

# options(scipen = 999)
# p<-plot(data=df1,y~x,log="y", type='n',axes=FALSE,ann=FALSE)
# breaks <- axTicks(side=2) 
# 
# 
# 
# p <- ggplot(data = est, aes(x=x , y=Contrast, group=1)) +
#   geom_point() + geom_line() +   guides(color=FALSE) +
#   geom_errorbar(aes(ymin=Lower, ymax=Upper ), color="black", width=.05, lwd=.5) 
# #scale_x_continuous(limits = c(1,3), expand = c(0.02, 0.02)) 
# 
# p1 <- p+  geom_line(data=df, aes(x = x, y = y, color = g, group=g),size=0.5,alpha=.4)  +
#   theme(text = element_text(size=10),
#         axis.text.x = element_text(angle = 0, vjust = 1, hjust=.5))+
#   scale_y_continuous(breaks=breaks, trans='log') +
#   
#          ylab("GH (ug/L)")  +
#           xlab("Visit")  +
#   
#    scale_x_continuous(breaks=c(1,2,3),
#         labels=c("Baseline", "Month 3", "Month 6"))+#
#   
#   EnvStats::stat_n_text(size = 4, y.pos = max(log(df$value), na.rm=T)*1.1 , y.expand.factor=0, 
#                           angle = 0, hjust = .5, family = "mono", fontface = "plain") +#295 bold
# 
#   
#   theme(panel.background=element_blank(),
#                 # axis.text.y=element_blank(),
#                 # axis.ticks.y=element_blank(),
#                 # https://stackoverflow.com/questions/46482846/ggplot2-x-axis-extreme-right-tick-label-clipped-after-insetting-legend
#                 # stop axis being clipped
#                 plot.title=element_text(), plot.margin = unit(c(5.5,12,5.5,5.5), "pt"), 
#                 legend.text=element_text(size=12),
#                 legend.title=element_text(size=14),
#                 axis.text.x  = element_text(size=10),
#                 axis.text.y  = element_text(size=10),
#                 axis.line.x = element_line(color="black"),
#                 axis.line.y = element_line(color="black"),
#                 plot.caption=element_text(hjust = 0, size = 7)) 
#    
#   p1
# 
# options(scipen = 0)


####
 
options(scipen = 999)
p<-plot(data=df1,y~x,log="y", type='n',axes=FALSE,ann=FALSE)
breaks <- axTicks(side=2) 

dplot <- merge(est,  df)

p <- ggplot(data = dplot, aes(x=x , y=Contrast, group=1)) +
  geom_point() + geom_line() +   guides(color=FALSE) +
  geom_errorbar(aes(ymin=Lower, ymax=Upper ), color="black", width=.05, lwd=.2) 
#scale_x_continuous(limits = c(1,3), expand = c(0.02, 0.02)) 

p1 <- p+  geom_line(data=dplot, aes(x = x, y = y, color = g, group=g),size=0.5,alpha=.4)  +
  theme(text = element_text(size=10),
        axis.text.x = element_text(angle = 0, vjust = 1, hjust=.5))+
  scale_y_continuous(breaks=breaks, trans='log') +
  
         ylab("GH (ug/L)")  +
          xlab("Visit")  +
  
   scale_x_continuous(breaks=c(1,2,3),
        labels=c("Baseline", "Month 3", "Month 6"))+#
  
  EnvStats::stat_n_text(size = 4, y.pos = max(log(dplot$value), na.rm=T)*1.1 , y.expand.factor=0, 
                          angle = 0, hjust = .5, family = "mono", fontface = "plain") +#295 bold

  
  theme(panel.background=element_blank(),
                # axis.text.y=element_blank(),
                # axis.ticks.y=element_blank(),
                # https://stackoverflow.com/questions/46482846/ggplot2-x-axis-extreme-right-tick-label-clipped-after-insetting-legend
                # stop axis being clipped
                plot.title=element_text(), plot.margin = unit(c(5.5,12,5.5,5.5), "pt"), 
                legend.text=element_text(size=12),
                legend.title=element_text(size=14),
                axis.text.x  = element_text(size=10),
                axis.text.y  = element_text(size=10),
                axis.line.x = element_line(color="black"),
                axis.line.y = element_line(color="black"),
                plot.caption=element_text(hjust = 0, size = 7)) 
   
  p1

options(scipen = 0)

```

## function using rtf package

```{r}

    require(rtf)
    require(ggplot2)
options(scipen = 999)
    
    # d <- foo[foo$visit %in% 1, ]
    
    # function that used ggplot and rtf to create rtf outputs
    # lots of text , l1 l2 l3 for x axes length and tick seq
    
    Gploth1 <- function(figname, projcode, text1, text2, text3, text4,  text5,rtf1,rtf2,rtf3,rtf4) {
      
      # ggplot plotting function
       
      
      myplot <- function() {
    
        dplot <- merge(est,  df)
        
        
         
      p<-plot(data=df1,y~x,log="y", type='n',axes=FALSE,ann=FALSE)
      breaks <- axTicks(side=2) 
 


p <- ggplot(data = dplot, aes(x=x , y=Contrast, group=1)) +
  geom_point() + geom_line() +   guides(color=FALSE) +
  geom_errorbar(aes(ymin=Lower, ymax=Upper ), color="black", width=.05, lwd=.2) 
#scale_x_continuous(limits = c(1,3), expand = c(0.02, 0.02)) 

p1 <- p+  geom_line(data=dplot, aes(x = x, y = y, color = g, group=g),size=0.5,alpha=.4)  +
  theme(text = element_text(size=10),
        axis.text.x = element_text(angle = 0, vjust = 1, hjust=.5))+
  scale_y_continuous(breaks=breaks, trans='log') +
  
         ylab("GH (ug/L)")  +
          xlab("Visit")  +
  
   scale_x_continuous(breaks=c(1,2,3),
        labels=c("Baseline", "Month 3", "Month 6"))+#
  
  EnvStats::stat_n_text(size = 4, y.pos = max(log(dplot$value), na.rm=T)*1.1 , y.expand.factor=0, 
                          angle = 0, hjust = .5, family = "mono", fontface = "plain") +#295 bold

  
    
    geom_segment(aes(x = 1, xend = 3, y = (1), yend=(1)), color = "black" , size=0.05, linetype="F1", alpha=0.2) +
        geom_segment(aes(x = 1, xend = 3, y = (2.5), yend=(2.5)), color = "black" , size=0.05, linetype="F1", alpha=0.2) +
  
  theme(panel.background=element_blank(),
                # axis.text.y=element_blank(),
                # axis.ticks.y=element_blank(),
                # https://stackoverflow.com/questions/46482846/ggplot2-x-axis-extreme-right-tick-label-clipped-after-insetting-legend
                # stop axis being clipped
                plot.title=element_text(), plot.margin = unit(c(5.5,12,5.5,5.5), "pt"), 
                legend.text=element_text(size=12),
                legend.title=element_text(size=14),
                axis.text.x  = element_text(size=10),
                axis.text.y  = element_text(size=10),
                axis.line.x = element_line(color="black"),
                axis.line.y = element_line(color="black"),
                plot.caption=element_text(hjust = 0, size = 7)) 
   
  


        
        print(p1)    
        
      }
      
      #####################################
      # end of myplot plotting function
      #####################################
      
 
      
      require(rtf)
      rtf <- RTF(paste(path.export,figname, sep="/"), font.size=10, omi=c(1,1,1,1), width=11, height=8.5)
      addText(rtf, paste("Figure",text1, "(Page 1 of 1) \n"), bold=T, italic=F)
      addText(rtf, paste(projcode,"\n"), bold=T, italic=F) 
      addText(rtf, paste(text2,"\n"), bold=T, italic=F)  
      addPlot(rtf, plot.fun=myplot, width=8, height=4.5, res=300) 
      addText(rtf, rtf1)
      addText(rtf, rtf2)
      addText(rtf, rtf3)
      addText(rtf, rtf4)
      #addText(rtf, paste0("Source: ",wd,"/",namex3,"  ",format(Sys.time(), "%b %d %Y, %H:%M:%S"), sep=" "))
      addText(rtf, paste0("Source: ",path.export,"/",namex3, "  ",format(Sys.time(), "%b %d %Y, %H:%M:%S"),sep=" "))
      
      done(rtf) 
      
    } 
    
    #####################################
    # end of Gplot function
    #####################################
         
      ####
      
    id <- "mean"                           # figure number
    id<-paste0(id,"")

                              # data set for plot
    variable <- "Reimbursement"          # variable of interest
                        # record numbers
   
    ylabel <-"GH (ug/L)"
    # text for plot
    verbiage = paste0("CSOM230CIC05 2nd Interim Analysis \nAbsolute change from baseline N=",length(unique(dplot$g)),":\nMonth 3 - Baseline: ",format(round(i[2,1],digits=1),nsmall=1)," ug/L, 95%CI (",
  format(round(i[2,2],digits=1),nsmall=1),", ",
  format(round(i[2,3],digits=1),nsmall=1),")\nMonth 6 - Baseline: ",     
  format(round(i[3,1],digits=1),nsmall=1)," ug/L, 95%CI (",
  format(round(i[3,2],digits=1),nsmall=1),", ",
  format(round(i[3,3],digits=1),nsmall=1),")")
    
    verbiage2="- Black symbols denote mean and 95% confidence interval at each visit; Dashed horizontal lines denote GH levels 1 & 2.5 ug/L.\n"
    
       verbiage1="- Coloured lines depict each patient's profile over time; n denotes data points at each visit; Black lines join medians at each time point.\n"

    verbiage3=paste0("- y axis presented using natural log transformed scale in order to make patterns more visible.\n")
    
    verbiage0=("Prospective Population Set\n")
    
    verbiage4 ='yyyyyyyyyyyyy' #not used
    
    verbiage5 ='yyyyyyyyyyyyy' #not used
    
    #format(round(a, digits=2), nsmall = 2) 
    #####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      ####
      #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# plot output
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# z/id/varr/gupper/glower/gstep...all defined in parameter.R
# all text defined in parameter.R 
 
file.id <- paste0("x.",id)
namex1 <- paste0("Figure ",file.id,".rtf")
namex2 <- file.id
namex3 <- paste0("Figure ",file.id,".R ") # space after R for better looking output 
#options(scipen = 999)
Gploth1(figname = namex1,  
      projcode=verbiage  , 
      text1 = namex2, 
      text2 = verbiage0 ,
      text3 = verbiage4, #not used
      text4 = verbiage5, #not used
      rtf1=   verbiage1,
      rtf2=   verbiage2,
      rtf3=   verbiage3,
      rtf4 =  paste0("")
)    
options(scipen =0)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# THE END HERE FOR PLOT 3
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 
```

 





















### REFERENCES

 

\clearpage

# COMPUTING ENVIRONMENT

```{r, echo=FALSE}

options(width=70)
dir. <- wd.code
opts_knit$set(root.dir = dir.)   ##THIS SETS YOUR WORKING DIRECTORY
sessionInfo()
print(getwd())
stopTime<-proc.time()

```

This took `r (stopTime-startTime)[1][[1]]` seconds to execute.

```{r echo=FALSE}

# move stangle R file to a folder in GPS
# put this at bottom & give it the same name as RMD file , replace any blanks with underscore
# https://amywhiteheadresearch.wordpress.com/2014/11/12/copying-files-with-r/
xxx<- "Summarising.R"
rcode <-  gsub(' ','_', trimws(xxx))          # replace blank with underscore, this is needed
file.copy(rcode, dir.,  overwrite=TRUE)       # make a copy of the rcode in a folder of choice
format(Sys.time(), "%a %b %d %X %Y")

```


